<div class="modal fade modal-load" tabindex="-1" data-bs-backdrop="static">
    <div class="modal-dialog modal-xl pt-standalone">
        <div class="modal-content rounded-5">
            <div class="d-flex w-100 justify-content-end align-items-center position-relative">
                <button type="button"
                    class="btn btn-primary position-absolute z-1 rounded-circle d-flex align-items-center justify-content-center width height top right"
                    data-bs-dismiss="modal" aria-label="Close"
                    style="--width:50px;--height:50px;--top:-5px;--right:-5px">
                    <i class="ti ti-x fs-4"></i>
                </button>
            </div>
            <div class="modal-body">
                 <h5 class="fw-bold text-body mb-3">
                    <?= $title1 ?>
                </h5>
                <form method="POST" action="<?= $_SERVER['REQUEST_URI'] ?>" enctype="multipart/form-data">
                    <div class="row g-3">
                        <div class="col-lg-12">
                            <div class="mb-3 d-none">
                                <label class="fw-bold text-body mb-2"><?= $jatbi->lang("Mã chi tiết dịch vụ") ?> <span class="text-danger">*</span></label>
                                <input type="text" name="id" class="form-control py-3 rounded-4 bg-body-tertiary"
                                    value="<?= $data['id'] ?? '' ?>" readonly>
                            </div>

                            <div class="mb-3">
                                <label class="fw-bold text-body mb-2"><?= $jatbi->lang("Dịch vụ") ?> <span class="text-danger">*</span></label>
                                <select name="service_id" class="form-control py-3 rounded-4 bg-body-tertiary" required>
                                    <option value=""><?= $jatbi->lang("Chọn dịch vụ") ?></option>
                                    <?php foreach ($services as $service): ?>
                                        <option value="<?= $service['id'] ?>" <?= isset($data['service_id']) && $data['service_id'] == $service['id'] ? 'selected' : '' ?>>
                                            <?= htmlspecialchars($service['title']) ?>
                                        </option>
                                    <?php endforeach; ?>
                                </select>
                            </div>

                            <div class="mb-3">
                                <label class="fw-bold text-body mb-2"><?= $jatbi->lang("Tiêu đề") ?> <span class="text-danger">*</span></label>
                                <input type="text" name="title" class="form-control py-3 rounded-4 bg-body-tertiary"
                                    placeholder="<?= $jatbi->lang("Tiêu đề") ?>" value="<?= htmlspecialchars($data['title'] ?? '') ?>" required>
                            </div>

                            <div class="mb-3">
                                <label class="fw-bold text-body mb-2"><?= $jatbi->lang("Mô tả tiêu đề") ?> <span class="text-danger">*</span></label>
                                <input type="text" name="description_title" class="form-control py-3 rounded-4 bg-body-tertiary"
                                    placeholder="<?= $jatbi->lang("Mô tả tiêu đề") ?>" value="<?= htmlspecialchars($data['description_title'] ?? '') ?>" required>
                            </div>

                            <div class="mb-3 row">
                                <div class="col-md-6">
                                    <label class="fw-bold text-body mb-2"><?= $jatbi->lang("Đánh giá") ?> <span class="text-danger">*</span></label>
                                    <input type="number" name="rate" class="form-control py-3 rounded-4 bg-body-tertiary"
                                        placeholder="<?= $jatbi->lang("Đánh giá (0-5)") ?>" step="0.1" min="0" max="5"
                                        value="<?= $data['rate'] ?? '' ?>" required>
                                </div>
                                <div class="col-md-6">
                                    <label class="fw-bold text-body mb-2"><?= $jatbi->lang("Giảm giá (%)") ?></label>
                                    <input type="number" name="discount" class="form-control py-3 rounded-4 bg-body-tertiary"
                                        placeholder="<?= $jatbi->lang("Giảm giá (0-100)") ?>" min="0" max="100"
                                        value="<?= $data['discount'] ?? '' ?>">
                                </div>
                            </div>

                            <div class="mb-3 row">
                                <div class="col-md-6">
                                    <label class="fw-bold text-body mb-2"><?= $jatbi->lang("Giá tối thiểu") ?> <span class="text-danger">*</span></label>
                                    <input type="number" name="min_price" class="form-control py-3 rounded-4 bg-body-tertiary"
                                        placeholder="<?= $jatbi->lang("Giá tối thiểu") ?>" min="0"
                                        value="<?= $data['min_price'] ?? '' ?>" required>
                                </div>
                                <div class="col-md-6">
                                    <label class="fw-bold text-body mb-2"><?= $jatbi->lang("Giá tối đa") ?> <span class="text-danger">*</span></label>
                                    <input type="number" name="max_price" class="form-control py-3 rounded-4 bg-body-tertiary"
                                        placeholder="<?= $jatbi->lang("Giá tối đa") ?>" min="0"
                                        value="<?= $data['max_price'] ?? '' ?>" required>
                                </div>
                            </div>

                            <div class="mb-3 row">
                                <div class="col-md-6">
                                    <label class="fw-bold text-body mb-2"><?= $jatbi->lang("Giá gốc tối thiểu") ?> <span class="text-danger">*</span></label>
                                    <input type="number" name="original_min_price" class="form-control py-3 rounded-4 bg-body-tertiary"
                                        placeholder="<?= $jatbi->lang("Giá gốc tối thiểu") ?>" min="0"
                                        value="<?= $data['original_min_price'] ?? '' ?>" required>
                                </div>
                                <div class="col-md-6">
                                    <label class="fw-bold text-body mb-2"><?= $jatbi->lang("Giá gốc tối đa") ?> <span class="text-danger">*</span></label>
                                    <input type="number" name="original_max_price" class="form-control py-3 rounded-4 bg-body-tertiary"
                                        placeholder="<?= $jatbi->lang("Giá gốc tối đa") ?>" min="0"
                                        value="<?= $data['original_max_price'] ?? '' ?>" required>
                                </div>
                            </div>

                            <div class="mb-3">
                                <label class="fw-bold text-body mb-2"><?= $jatbi->lang("Đối tượng") ?> <span class="text-danger">*</span></label>
                                <input type="text" name="object" class="form-control py-3 rounded-4 bg-body-tertiary"
                                    placeholder="<?= $jatbi->lang("Đối tượng") ?>" value="<?= htmlspecialchars($data['object'] ?? '') ?>" required>
                            </div>

                            <div class="mb-3">
                                <label class="fw-bold text-body mb-2"><?= $jatbi->lang("Nội dung") ?></label>
                                <div id="editor-container" class="bg-body-tertiary rounded-4" style="height: 300px;"></div>
                                <input type="hidden" name="content" id="content"
                                    value="<?= htmlspecialchars($data['content'] ?? '', ENT_QUOTES, 'UTF-8') ?>">
                            </div>

                            <div class="mb-3">
                                <label class="fw-bold text-body mb-2"><?= $jatbi->lang("Chuyên gia") ?></label>
                                <select name="author_box_id" class="form-control py-3 rounded-4 bg-body-tertiary">
                                    <option value=""><?= $jatbi->lang("Chọn chuyên gia") ?></option>
                                    <?php foreach ($author_boxes as $author): ?>
                                        <option value="<?= $author['id'] ?>" <?= isset($data['author_box_id']) && $data['author_box_id'] == $author['id'] ? 'selected' : '' ?>>
                                            <?= htmlspecialchars($author['name']) ?>
                                        </option>
                                    <?php endforeach; ?>
                                </select>
                            </div>
                        </div>

                        <div class="col-lg-12">
                            <button type="submit" class="btn btn-primary w-100 py-3 rounded-pill fw-bold"
                                data-action="submit" data-alert="true" data-load="this">
                                <?= $jatbi->lang("Hoàn thành") ?>
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.quilljs.com/1.3.7/quill.js"></script>
<script>
    var quill = new Quill('#editor-container', {
        theme: 'snow',
        modules: {
            toolbar: [
                [{'header': [1, 2, 3, 4, 5, 6, false]}],
                ['bold', 'italic', 'underline', 'strike'],
                [{'color': []}, {'background': []}],
                [{'align': []}],
                ['image', 'video'],
                ['clean']
            ]
        },
        placeholder: '<?= $jatbi->lang("Nội dung") ?>',
    });

    var contentInput = document.getElementById('content');
    if (contentInput.value) {
        quill.root.innerHTML = contentInput.value;
    }

    quill.on('text-change', function () {
        contentInput.value = quill.root.innerHTML;
    });
</script>